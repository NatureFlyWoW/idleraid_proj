import type { ClassDefinition, AbilityDefinition, TalentTreeDefinition } from '@shared/types';

// ============= ROGUE ABILITIES =============
// Rogues use Energy (regenerates 10/sec) and Combo Points (1-5)
// Builders generate combo points, Finishers consume them

const rogueAbilities: AbilityDefinition[] = [
  // Combo Point Builders
  {
    id: 'sinister_strike',
    name: 'Sinister Strike',
    description: 'An instant strike that deals weapon damage plus 68 and awards 1 combo point.',
    type: 'instant',
    resourceCost: 45, // Energy
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 68,
    baseHealing: 0,
    apCoefficient: 0.15,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    levelRequired: 1,
  },
  {
    id: 'backstab',
    name: 'Backstab',
    description: 'Requires a dagger. Backstab the target for 150% weapon damage plus 150. Must be behind the target. Awards 1 combo point.',
    type: 'instant',
    resourceCost: 60,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 150,
    baseHealing: 0,
    apCoefficient: 0.3,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'dagger',
    levelRequired: 4,
  },
  {
    id: 'gouge',
    name: 'Gouge',
    description: 'Incapacitates the target for up to 4 seconds. Awards 1 combo point. Target must be facing you.',
    type: 'instant',
    resourceCost: 45,
    cooldownSeconds: 10,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 6,
  },
  {
    id: 'ambush',
    name: 'Ambush',
    description: 'Requires a dagger. Ambush the target for 275% weapon damage plus 200. Must be stealthed. Awards 2 combo points.',
    type: 'instant',
    resourceCost: 60,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 200,
    baseHealing: 0,
    apCoefficient: 0.75,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'dagger',
    levelRequired: 18,
  },
  {
    id: 'cheap_shot',
    name: 'Cheap Shot',
    description: 'Stuns the target for 4 seconds. Must be stealthed. Awards 2 combo points.',
    type: 'instant',
    resourceCost: 60,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 26,
  },
  {
    id: 'hemorrhage',
    name: 'Hemorrhage',
    description: 'A weapon strike that causes 110% weapon damage and causes the target to hemorrhage, increasing Physical damage dealt to the target. Awards 1 combo point.',
    type: 'instant',
    resourceCost: 35,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0.1,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    requiresTalent: 'hemorrhage_talent',
    levelRequired: 30,
  },
  {
    id: 'mutilate',
    name: 'Mutilate',
    description: 'Requires 2 daggers. Instantly attacks with both weapons for 101% damage plus 101 per weapon. Awards 2 combo points.',
    type: 'instant',
    resourceCost: 60,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 101,
    baseHealing: 0,
    apCoefficient: 0.2,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'dagger',
    requiresTalent: 'mutilate_talent',
    levelRequired: 40,
  },
  // Combo Point Finishers
  {
    id: 'eviscerate',
    name: 'Eviscerate',
    description: 'Finishing move that deals damage per combo point: 1 point: 131-201, 5 points: 629-705.',
    type: 'instant',
    resourceCost: 35,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 450, // Average at 5 combo points
    baseHealing: 0,
    apCoefficient: 0.3,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    levelRequired: 1,
  },
  {
    id: 'slice_and_dice',
    name: 'Slice and Dice',
    description: 'Finishing move that increases attack speed by 30% for a duration based on combo points: 1 point: 9 sec, 5 points: 21 sec.',
    type: 'instant',
    resourceCost: 25,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 10,
  },
  {
    id: 'rupture',
    name: 'Rupture',
    description: 'Finishing move that causes damage over time based on combo points: 1 point: 108 over 8 sec, 5 points: 448 over 16 sec.',
    type: 'instant',
    resourceCost: 25,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 448, // At 5 combo points
    baseHealing: 0,
    apCoefficient: 0.24,
    spCoefficient: 0,
    isAoE: false,
    isDot: true,
    isHot: false,
    tickCount: 8,
    tickIntervalSeconds: 2,
    requiresWeapon: 'melee',
    levelRequired: 20,
  },
  {
    id: 'kidney_shot',
    name: 'Kidney Shot',
    description: 'Finishing move that stuns the target based on combo points: 1 point: 2 sec, 5 points: 6 sec.',
    type: 'instant',
    resourceCost: 25,
    cooldownSeconds: 20,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 30,
  },
  {
    id: 'expose_armor',
    name: 'Expose Armor',
    description: 'Finishing move that exposes the target for 30 seconds, reducing armor per combo point: 5 points: 2050 armor reduction.',
    type: 'instant',
    resourceCost: 25,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 14,
  },
  {
    id: 'envenom',
    name: 'Envenom',
    description: 'Finishing move that consumes Deadly Poison doses to deal instant Nature damage per combo point and dose.',
    type: 'instant',
    resourceCost: 35,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 300,
    baseHealing: 0,
    apCoefficient: 0.2,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'envenom_talent',
    levelRequired: 50,
  },
  // Stealth and Utility
  {
    id: 'stealth',
    name: 'Stealth',
    description: 'Allows the rogue to sneak around undetected. Lasts until cancelled. Cannot be used in combat.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 10,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 1,
  },
  {
    id: 'vanish',
    name: 'Vanish',
    description: 'Allows the rogue to vanish from sight, entering Stealth instantly. Can be used in combat.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 180, // 3 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 22,
  },
  {
    id: 'sprint',
    name: 'Sprint',
    description: 'Increases movement speed by 70% for 15 seconds.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 180, // 3 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 16,
  },
  {
    id: 'evasion',
    name: 'Evasion',
    description: 'Increases your chance to dodge melee attacks by 50% for 15 seconds.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 300, // 5 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 8,
  },
  {
    id: 'kick',
    name: 'Kick',
    description: 'A quick kick that interrupts spellcasting and prevents casting in that school for 5 seconds.',
    type: 'instant',
    resourceCost: 25,
    cooldownSeconds: 10,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 12,
  },
  {
    id: 'blind',
    name: 'Blind',
    description: 'Blinds the target, causing it to wander disoriented for up to 10 seconds. Any damage causes the effect to end.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 180, // 3 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 34,
  },
  // Poisons
  {
    id: 'instant_poison',
    name: 'Instant Poison',
    description: 'Coats a weapon with poison. Each strike has a 20% chance of dealing 112-148 Nature damage.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 130,
    baseHealing: 0,
    apCoefficient: 0.1,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 20,
  },
  {
    id: 'deadly_poison',
    name: 'Deadly Poison',
    description: 'Coats a weapon with poison. Each strike has a 30% chance of poisoning the enemy for 296 Nature damage over 12 seconds. Stacks 5 times.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 296,
    baseHealing: 0,
    apCoefficient: 0.12,
    spCoefficient: 0,
    isAoE: false,
    isDot: true,
    isHot: false,
    tickCount: 4,
    tickIntervalSeconds: 3,
    levelRequired: 30,
  },
  // Talent abilities
  {
    id: 'cold_blood',
    name: 'Cold Blood',
    description: 'When activated, increases the critical strike chance of your next offensive ability by 100%.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 180, // 3 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'cold_blood_talent',
    levelRequired: 40,
  },
  {
    id: 'blade_flurry',
    name: 'Blade Flurry',
    description: 'Increases attack speed by 20% and causes all melee attacks to also hit a nearby target for 15 seconds.',
    type: 'instant',
    resourceCost: 25,
    cooldownSeconds: 120, // 2 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'blade_flurry_talent',
    levelRequired: 30,
  },
  {
    id: 'adrenaline_rush',
    name: 'Adrenaline Rush',
    description: 'Increases Energy regeneration by 100% for 15 seconds.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 300, // 5 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'adrenaline_rush_talent',
    levelRequired: 40,
  },
  {
    id: 'premeditation',
    name: 'Premeditation',
    description: 'When used, adds 2 combo points to your target. Must be stealthed. Combo points are lost if not used within 10 seconds.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 120, // 2 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'premeditation_talent',
    levelRequired: 30,
  },
  {
    id: 'shadowstep',
    name: 'Shadowstep',
    description: 'Attempts to step through the shadows and appear behind your target. Increases movement speed by 70% for 3 seconds.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 30,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'shadowstep_talent',
    levelRequired: 40,
  },
];

// ============= TALENT TREES =============

const assassinationTalentTree: TalentTreeDefinition = {
  id: 'assassination',
  name: 'Assassination',
  description: 'Focuses on poisons, daggers, and burst damage through critical strikes.',
  role: 'dps',
  talents: [
    // Tier 1
    {
      id: 'improved_eviscerate',
      name: 'Improved Eviscerate',
      description: 'Increases the damage done by your Eviscerate ability by 5/10/15%.',
      tier: 1,
      column: 1,
      maxRanks: 3,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'eviscerate', stat: 'damage', valuePerRank: 5, isPercentage: true }],
    },
    {
      id: 'malice',
      name: 'Malice',
      description: 'Increases your critical strike chance by 1/2/3/4/5%.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'critChance', valuePerRank: 1, isPercentage: true }],
    },
    {
      id: 'ruthlessness',
      name: 'Ruthlessness',
      description: 'Gives your finishing moves a 20/40/60% chance to add a combo point to your target.',
      tier: 1,
      column: 3,
      maxRanks: 3,
      requiredPoints: 0,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 20, procTrigger: 'finisher', procEffect: 'combo_point', valuePerRank: 20 }],
    },
    // Tier 2
    {
      id: 'murder',
      name: 'Murder',
      description: 'Increases all damage caused against Humanoid, Giant, Beast and Dragonkin targets by 1/2%.',
      tier: 2,
      column: 1,
      maxRanks: 2,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'targetTypeDamage', valuePerRank: 1, isPercentage: true }],
    },
    {
      id: 'improved_slice_and_dice',
      name: 'Improved Slice and Dice',
      description: 'Increases the duration of your Slice and Dice ability by 15/30/45%.',
      tier: 2,
      column: 3,
      maxRanks: 3,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'slice_and_dice', stat: 'duration', valuePerRank: 15, isPercentage: true }],
    },
    // Tier 3
    {
      id: 'relentless_strikes',
      name: 'Relentless Strikes',
      description: 'Your finishing moves have a 20% chance per combo point to restore 25 Energy.',
      tier: 3,
      column: 1,
      maxRanks: 1,
      requiredPoints: 10,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 20, procTrigger: 'finisher_per_cp', procEffect: 'energy_restore', valuePerRank: 25 }],
    },
    {
      id: 'improved_expose_armor',
      name: 'Improved Expose Armor',
      description: 'Increases the armor reduced by your Expose Armor ability by 25/50%.',
      tier: 3,
      column: 2,
      maxRanks: 2,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'expose_armor', stat: 'armorReduction', valuePerRank: 25, isPercentage: true }],
    },
    {
      id: 'lethality',
      name: 'Lethality',
      description: 'Increases the critical strike damage bonus of your Backstab, Ambush, and Eviscerate by 6/12/18/24/30%.',
      tier: 3,
      column: 3,
      maxRanks: 5,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'backstabCritDamage', valuePerRank: 6, isPercentage: true }],
    },
    // Tier 4
    {
      id: 'vile_poisons',
      name: 'Vile Poisons',
      description: 'Increases the damage dealt by your poisons by 4/8/12/16/20% and gives your poisons an additional 8/16/24/32/40% chance to resist dispel.',
      tier: 4,
      column: 2,
      maxRanks: 5,
      requiredPoints: 15,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'poisonDamage', valuePerRank: 4, isPercentage: true }],
    },
    {
      id: 'improved_poisons',
      name: 'Improved Poisons',
      description: 'Increases the chance to apply poisons to your target by 2/4/6/8/10%.',
      tier: 4,
      column: 3,
      maxRanks: 5,
      requiredPoints: 15,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'poisonApplyChance', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 5
    {
      id: 'cold_blood_talent',
      name: 'Cold Blood',
      description: 'When activated, increases the critical strike chance of your next offensive ability by 100%.',
      tier: 5,
      column: 2,
      maxRanks: 1,
      requiredPoints: 20,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'cold_blood', valuePerRank: 1 }],
    },
    {
      id: 'seal_fate',
      name: 'Seal Fate',
      description: 'Your critical strikes from abilities that add combo points have a 20/40/60/80/100% chance to add an additional combo point.',
      tier: 5,
      column: 3,
      maxRanks: 5,
      requiredPoints: 20,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 20, procTrigger: 'builder_crit', procEffect: 'extra_combo_point', valuePerRank: 20 }],
    },
    // Tier 7 - Capstone
    {
      id: 'mutilate_talent',
      name: 'Mutilate',
      description: 'Instantly attacks with both weapons for significant damage. Awards 2 combo points.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'mutilate', valuePerRank: 1 }],
    },
  ],
};

const combatTalentTree: TalentTreeDefinition = {
  id: 'combat',
  name: 'Combat',
  description: 'Focuses on sustained damage with swords, maces, and fist weapons.',
  role: 'dps',
  talents: [
    // Tier 1
    {
      id: 'improved_gouge',
      name: 'Improved Gouge',
      description: 'Increases the effect duration of your Gouge ability by 0.5/1/1.5 seconds.',
      tier: 1,
      column: 1,
      maxRanks: 3,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'gouge', stat: 'duration', valuePerRank: 0.5 }],
    },
    {
      id: 'improved_sinister_strike',
      name: 'Improved Sinister Strike',
      description: 'Reduces the Energy cost of your Sinister Strike ability by 3/6 Energy.',
      tier: 1,
      column: 2,
      maxRanks: 2,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'sinister_strike', stat: 'resourceCost', valuePerRank: -3 }],
    },
    {
      id: 'lightning_reflexes',
      name: 'Lightning Reflexes',
      description: 'Increases your Dodge chance by 1/2/3/4/5%.',
      tier: 1,
      column: 3,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'dodgeChance', valuePerRank: 1, isPercentage: true }],
    },
    // Tier 2
    {
      id: 'improved_backstab',
      name: 'Improved Backstab',
      description: 'Increases the critical strike chance of your Backstab ability by 10/20/30%.',
      tier: 2,
      column: 1,
      maxRanks: 3,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'backstab', stat: 'critChance', valuePerRank: 10 }],
    },
    {
      id: 'deflection',
      name: 'Deflection',
      description: 'Increases your Parry chance by 1/2/3/4/5%.',
      tier: 2,
      column: 2,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'parryChance', valuePerRank: 1, isPercentage: true }],
    },
    {
      id: 'precision',
      name: 'Precision',
      description: 'Increases your chance to hit with melee weapons by 1/2/3/4/5%.',
      tier: 2,
      column: 3,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'meleeHit', valuePerRank: 1, isPercentage: true }],
    },
    // Tier 3
    {
      id: 'riposte',
      name: 'Riposte',
      description: 'A strike that becomes active after parrying an opponent\'s attack. Deals weapon damage plus 150.',
      tier: 3,
      column: 1,
      maxRanks: 1,
      requiredPoints: 10,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'riposte', valuePerRank: 1 }],
    },
    {
      id: 'dual_wield_specialization',
      name: 'Dual Wield Specialization',
      description: 'Increases the damage done by your offhand weapon by 10/20/30/40/50%.',
      tier: 3,
      column: 2,
      maxRanks: 5,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'offhandDamage', valuePerRank: 10, isPercentage: true }],
    },
    // Tier 4
    {
      id: 'blade_flurry_talent',
      name: 'Blade Flurry',
      description: 'Increases attack speed by 20% and causes melee attacks to hit a nearby enemy.',
      tier: 4,
      column: 2,
      maxRanks: 1,
      requiredPoints: 15,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'blade_flurry', valuePerRank: 1 }],
    },
    {
      id: 'sword_specialization',
      name: 'Sword Specialization',
      description: 'Gives you a 1/2/3/4/5% chance to get an extra attack on the same target after hitting with your Sword.',
      tier: 4,
      column: 3,
      maxRanks: 5,
      requiredPoints: 15,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 1, procTrigger: 'sword_hit', procEffect: 'extra_attack', valuePerRank: 1 }],
    },
    // Tier 5
    {
      id: 'weapon_expertise',
      name: 'Weapon Expertise',
      description: 'Increases your expertise by 5/10, reducing the chance your attacks will be dodged or parried.',
      tier: 5,
      column: 2,
      maxRanks: 2,
      requiredPoints: 20,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'expertise', valuePerRank: 5 }],
    },
    {
      id: 'aggression',
      name: 'Aggression',
      description: 'Increases the damage of your Sinister Strike, Backstab, and Eviscerate by 2/4/6%.',
      tier: 5,
      column: 3,
      maxRanks: 3,
      requiredPoints: 20,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'sinisterStrikeDamage', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 7 - Capstone
    {
      id: 'adrenaline_rush_talent',
      name: 'Adrenaline Rush',
      description: 'Increases Energy regeneration by 100% for 15 seconds.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'adrenaline_rush', valuePerRank: 1 }],
    },
  ],
};

const subtletyTalentTree: TalentTreeDefinition = {
  id: 'subtlety',
  name: 'Subtlety',
  description: 'Focuses on stealth, control, and openers from the shadows.',
  role: 'dps',
  talents: [
    // Tier 1
    {
      id: 'master_of_deception',
      name: 'Master of Deception',
      description: 'Reduces the chance enemies have to detect you while in Stealth mode by 3/6/9/12/15%.',
      tier: 1,
      column: 1,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'stealthDetection', valuePerRank: -3, isPercentage: true }],
    },
    {
      id: 'opportunity',
      name: 'Opportunity',
      description: 'Increases the damage dealt when striking from behind with Backstab, Ambush, or Garrote by 4/8/12/16/20%.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'behindDamage', valuePerRank: 4, isPercentage: true }],
    },
    {
      id: 'sleight_of_hand',
      name: 'Sleight of Hand',
      description: 'Reduces the chance you are critically hit by melee attacks by 1/2% and increases the threat reduction of Feint by 10/20%.',
      tier: 1,
      column: 3,
      maxRanks: 2,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'meleeCritReduction', valuePerRank: 1, isPercentage: true }],
    },
    // Tier 2
    {
      id: 'camouflage',
      name: 'Camouflage',
      description: 'Increases your speed while stealthed by 5/10/15% and reduces the cooldown of Stealth by 2/4/6 seconds.',
      tier: 2,
      column: 1,
      maxRanks: 3,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'stealthSpeed', valuePerRank: 5, isPercentage: true }],
    },
    {
      id: 'elusiveness',
      name: 'Elusiveness',
      description: 'Reduces the cooldown of your Vanish and Blind abilities by 30/60 seconds.',
      tier: 2,
      column: 2,
      maxRanks: 2,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'vanish', stat: 'cooldown', valuePerRank: -30 }],
    },
    {
      id: 'ghostly_strike',
      name: 'Ghostly Strike',
      description: 'A strike that deals 125% weapon damage and increases your dodge by 15% for 7 seconds. Awards 1 combo point.',
      tier: 2,
      column: 3,
      maxRanks: 1,
      requiredPoints: 5,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'ghostly_strike', valuePerRank: 1 }],
    },
    // Tier 3
    {
      id: 'initiative',
      name: 'Initiative',
      description: 'Gives you a 25/50/75% chance to add an additional combo point to your target when using your Ambush, Garrote, or Cheap Shot ability.',
      tier: 3,
      column: 1,
      maxRanks: 3,
      requiredPoints: 10,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 25, procTrigger: 'opener', procEffect: 'extra_combo_point', valuePerRank: 25 }],
    },
    {
      id: 'improved_ambush',
      name: 'Improved Ambush',
      description: 'Increases the critical strike chance of your Ambush ability by 25/50%.',
      tier: 3,
      column: 2,
      maxRanks: 2,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'ambush', stat: 'critChance', valuePerRank: 25 }],
    },
    {
      id: 'premeditation_talent',
      name: 'Premeditation',
      description: 'When used while stealthed, adds 2 combo points to your target. Must be used within 10 seconds.',
      tier: 3,
      column: 3,
      maxRanks: 1,
      requiredPoints: 10,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'premeditation', valuePerRank: 1 }],
    },
    // Tier 4
    {
      id: 'preparation',
      name: 'Preparation',
      description: 'When activated, resets the cooldown on Evasion, Sprint, Vanish, Cold Blood, and Premeditation.',
      tier: 4,
      column: 2,
      maxRanks: 1,
      requiredPoints: 15,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'preparation', valuePerRank: 1 }],
    },
    {
      id: 'dirty_deeds',
      name: 'Dirty Deeds',
      description: 'Reduces the Energy cost of your Cheap Shot and Garrote abilities by 10/20 and increases your special ability damage against targets below 35% health by 10/20%.',
      tier: 4,
      column: 3,
      maxRanks: 2,
      requiredPoints: 15,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'cheap_shot', stat: 'resourceCost', valuePerRank: -10 }],
    },
    // Tier 5
    {
      id: 'hemorrhage_talent',
      name: 'Hemorrhage',
      description: 'A weapon strike that causes hemorrhaging, increasing Physical damage dealt to the target.',
      tier: 5,
      column: 2,
      maxRanks: 1,
      requiredPoints: 20,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'hemorrhage', valuePerRank: 1 }],
    },
    {
      id: 'deadliness',
      name: 'Deadliness',
      description: 'Increases your Attack Power by 2/4/6/8/10%.',
      tier: 5,
      column: 3,
      maxRanks: 5,
      requiredPoints: 20,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'attackPower', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 7 - Capstone
    {
      id: 'shadowstep_talent',
      name: 'Shadowstep',
      description: 'Teleport behind your target and gain 70% movement speed for 3 seconds.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'shadowstep', valuePerRank: 1 }],
    },
  ],
};

// ============= ROGUE CLASS DEFINITION =============

export const rogueClass: ClassDefinition = {
  id: 'rogue',
  name: 'Rogue',
  description: 'Stealthy assassins who strike from the shadows using a combo point system. They build combo points with quick attacks and unleash them with powerful finishing moves.',
  resourceType: 'energy',
  armorType: 'leather',

  baseStats: {
    health: 75,
    resource: 100, // Energy, always 100
    strength: 12,
    agility: 24,
    intellect: 8,
    stamina: 12,   // GDD: 12
    spirit: 10,
  },

  statScaling: {
    strengthToAP: 1.0,           // 1 STR = 1 AP
    agilityToAP: 1.0,            // 1 AGI = 1 AP
    agilityToCrit: 0.04,         // 1 AGI = 0.04% crit (higher than most)
    agilityToRangedAP: 0,        // No ranged benefit
    intellectToMana: 0,          // No mana
    intellectToSpellPower: 0,
    intellectToSpellCrit: 0,
    staminaToHealth: 10,
    spiritToRegen: 0,            // Energy regenerates at fixed rate
  },

  talentTrees: [assassinationTalentTree, combatTalentTree, subtletyTalentTree],
  abilities: rogueAbilities,
};

export default rogueClass;
