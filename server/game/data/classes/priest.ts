import type { ClassDefinition, AbilityDefinition, TalentTreeDefinition } from '@shared/types';

// ============= PRIEST ABILITIES =============

const priestAbilities: AbilityDefinition[] = [
  // Core healing abilities
  {
    id: 'lesser_heal',
    name: 'Lesser Heal',
    description: 'Heal your target for 307 to 353.',
    type: 'cast',
    resourceCost: 75,
    cooldownSeconds: 0,
    castTimeSeconds: 2.0,
    baseDamage: 0,
    baseHealing: 330,
    apCoefficient: 0,
    spCoefficient: 0.571,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 1,
  },
  {
    id: 'heal',
    name: 'Heal',
    description: 'Heal your target for 586 to 662.',
    type: 'cast',
    resourceCost: 255,
    cooldownSeconds: 0,
    castTimeSeconds: 2.5,
    baseDamage: 0,
    baseHealing: 624,
    apCoefficient: 0,
    spCoefficient: 0.714,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 16,
  },
  {
    id: 'greater_heal',
    name: 'Greater Heal',
    description: 'A slow casting heal that heals your target for 1813 to 2021.',
    type: 'cast',
    resourceCost: 370,
    cooldownSeconds: 0,
    castTimeSeconds: 3.0,
    baseDamage: 0,
    baseHealing: 1917,
    apCoefficient: 0,
    spCoefficient: 0.857,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 40,
  },
  {
    id: 'flash_heal',
    name: 'Flash Heal',
    description: 'Heals a friendly target for 564 to 646.',
    type: 'cast',
    resourceCost: 380,
    cooldownSeconds: 0,
    castTimeSeconds: 1.5,
    baseDamage: 0,
    baseHealing: 605,
    apCoefficient: 0,
    spCoefficient: 0.429,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 20,
  },
  {
    id: 'renew',
    name: 'Renew',
    description: 'Heals the target for 970 over 15 seconds.',
    type: 'instant',
    resourceCost: 305,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 970,
    apCoefficient: 0,
    spCoefficient: 1.0,
    isAoE: false,
    isDot: false,
    isHot: true,
    tickCount: 5,
    tickIntervalSeconds: 3,
    levelRequired: 8,
  },
  {
    id: 'power_word_shield',
    name: 'Power Word: Shield',
    description: 'Draws on the soul of the friendly target to shield them, absorbing 942 damage.',
    type: 'instant',
    resourceCost: 500,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 942, // Shield amount
    apCoefficient: 0,
    spCoefficient: 0.1,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 6,
  },
  // Damage abilities
  {
    id: 'smite',
    name: 'Smite',
    description: 'Smites an enemy for 212 to 238 Holy damage.',
    type: 'cast',
    resourceCost: 185,
    cooldownSeconds: 0,
    castTimeSeconds: 2.0,
    baseDamage: 225,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.714,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 1,
  },
  {
    id: 'shadow_word_pain',
    name: 'Shadow Word: Pain',
    description: 'A word of darkness that causes 936 Shadow damage over 18 seconds.',
    type: 'instant',
    resourceCost: 470,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 936,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 1.0,
    isAoE: false,
    isDot: true,
    isHot: false,
    tickCount: 6,
    tickIntervalSeconds: 3,
    levelRequired: 4,
  },
  {
    id: 'mind_blast',
    name: 'Mind Blast',
    description: 'Blasts the target for 503 to 531 Shadow damage.',
    type: 'cast',
    resourceCost: 350,
    cooldownSeconds: 8,
    castTimeSeconds: 1.5,
    baseDamage: 517,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.429,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 10,
  },
  {
    id: 'mind_flay',
    name: 'Mind Flay',
    description: 'Assaults the target\'s mind with Shadow energy, causing 426 damage over 3 seconds and slowing.',
    type: 'channel',
    resourceCost: 205,
    cooldownSeconds: 0,
    castTimeSeconds: 3.0,
    baseDamage: 426,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.45,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 20,
  },
  // Talent abilities
  {
    id: 'power_infusion',
    name: 'Power Infusion',
    description: 'Infuses the target with power, increasing spell damage and healing by 20% for 15 seconds.',
    type: 'instant',
    resourceCost: 350,
    cooldownSeconds: 180, // 3 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'power_infusion_talent',
    levelRequired: 40,
  },
  {
    id: 'shadowform',
    name: 'Shadowform',
    description: 'Assume a Shadowform, increasing Shadow damage by 15% but preventing Holy spells.',
    type: 'instant',
    resourceCost: 250,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'shadowform_talent',
    levelRequired: 40,
  },
  {
    id: 'circle_of_healing',
    name: 'Circle of Healing',
    description: 'Heals all friendly party members within 15 yards for 323 to 361.',
    type: 'instant',
    resourceCost: 450,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 342,
    apCoefficient: 0,
    spCoefficient: 0.25,
    isAoE: true,
    maxTargets: 5,
    isDot: false,
    isHot: false,
    requiresTalent: 'circle_of_healing_talent',
    levelRequired: 50,
  },
];

// ============= TALENT TREES =============

const disciplineTalentTree: TalentTreeDefinition = {
  id: 'discipline',
  name: 'Discipline',
  description: 'Focuses on damage prevention, shielding, and mana efficiency.',
  role: 'healer',
  talents: [
    // Tier 1
    {
      id: 'unbreakable_will',
      name: 'Unbreakable Will',
      description: 'Increases your chance to resist Stun, Fear, and Silence effects by 3/6/9/12/15%.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'ccResist', valuePerRank: 3, isPercentage: true }],
    },
    {
      id: 'wand_specialization',
      name: 'Wand Specialization',
      description: 'Increases your damage with Wands by 5/10/15/20/25%.',
      tier: 1,
      column: 3,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'wandDamage', valuePerRank: 5, isPercentage: true }],
    },
    // Tier 2
    {
      id: 'improved_power_word_shield',
      name: 'Improved Power Word: Shield',
      description: 'Increases the damage absorbed by your Power Word: Shield by 5/10/15%.',
      tier: 2,
      column: 1,
      maxRanks: 3,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'power_word_shield', stat: 'shieldAmount', valuePerRank: 5, isPercentage: true }],
    },
    {
      id: 'improved_power_word_fortitude',
      name: 'Improved Power Word: Fortitude',
      description: 'Increases the effect of your Power Word: Fortitude spell by 15/30%.',
      tier: 2,
      column: 2,
      maxRanks: 2,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'power_word_fortitude', stat: 'staminaBonus', valuePerRank: 15, isPercentage: true }],
    },
    {
      id: 'martyrdom',
      name: 'Martyrdom',
      description: 'Gives you a 50/100% chance to gain the Focused Casting effect when you are hit by a melee or ranged critical strike.',
      tier: 2,
      column: 3,
      maxRanks: 2,
      requiredPoints: 5,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 50, procTrigger: 'receive_crit', procEffect: 'focused_casting', valuePerRank: 50 }],
    },
    // Tier 3
    {
      id: 'inner_focus',
      name: 'Inner Focus',
      description: 'When activated, reduces the mana cost of your next spell by 100% and increases its critical strike chance by 25%.',
      tier: 3,
      column: 2,
      maxRanks: 1,
      requiredPoints: 10,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'inner_focus', valuePerRank: 1 }],
    },
    {
      id: 'meditation',
      name: 'Meditation',
      description: 'Allows 5/10/15% of your mana regeneration to continue while casting.',
      tier: 3,
      column: 3,
      maxRanks: 3,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'manaRegenWhileCasting', valuePerRank: 5, isPercentage: true }],
    },
    // Tier 4
    {
      id: 'mental_agility',
      name: 'Mental Agility',
      description: 'Reduces the mana cost of your instant cast spells by 2/4/6/8/10%.',
      tier: 4,
      column: 2,
      maxRanks: 5,
      requiredPoints: 15,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'instantCastManaCost', valuePerRank: -2, isPercentage: true }],
    },
    // Tier 5
    {
      id: 'divine_spirit',
      name: 'Divine Spirit',
      description: 'Unlocks the Divine Spirit buff that increases target\'s Spirit by 40.',
      tier: 5,
      column: 2,
      maxRanks: 1,
      requiredPoints: 20,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'divine_spirit', valuePerRank: 1 }],
    },
    {
      id: 'improved_divine_spirit',
      name: 'Improved Divine Spirit',
      description: 'Your Divine Spirit also increases spell damage and healing by an amount equal to 5/10% of the target\'s total Spirit.',
      tier: 5,
      column: 3,
      maxRanks: 2,
      requiredPoints: 20,
      requiredTalentId: 'divine_spirit',
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'spiritToSpellPower', valuePerRank: 5, isPercentage: true }],
    },
    // Tier 7 - Capstone
    {
      id: 'power_infusion_talent',
      name: 'Power Infusion',
      description: 'Infuses the target with power, increasing spell damage and healing by 20% for 15 seconds.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'power_infusion', valuePerRank: 1 }],
    },
  ],
};

const holyTalentTree: TalentTreeDefinition = {
  id: 'holy',
  name: 'Holy',
  description: 'Focuses on pure healing throughput and group healing.',
  role: 'healer',
  talents: [
    // Tier 1
    {
      id: 'healing_focus',
      name: 'Healing Focus',
      description: 'Gives you a 14/28/42/56/70% chance to avoid interruption caused by damage while casting healing spells.',
      tier: 1,
      column: 1,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'healingPushbackResist', valuePerRank: 14, isPercentage: true }],
    },
    {
      id: 'improved_renew',
      name: 'Improved Renew',
      description: 'Increases the amount healed by your Renew spell by 5/10/15%.',
      tier: 1,
      column: 2,
      maxRanks: 3,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'renew', stat: 'healing', valuePerRank: 5, isPercentage: true }],
    },
    {
      id: 'holy_specialization',
      name: 'Holy Specialization',
      description: 'Increases the critical strike chance of your Holy spells by 1/2/3/4/5%.',
      tier: 1,
      column: 3,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'holyCritChance', valuePerRank: 1, isPercentage: true }],
    },
    // Tier 2
    {
      id: 'divine_fury',
      name: 'Divine Fury',
      description: 'Reduces the casting time of your Smite, Holy Fire, Heal and Greater Heal spells by 0.1/0.2/0.3/0.4/0.5 seconds.',
      tier: 2,
      column: 2,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'greater_heal', stat: 'castTime', valuePerRank: -0.1 }],
    },
    // Tier 3
    {
      id: 'inspiration',
      name: 'Inspiration',
      description: 'Increases your target\'s armor by 8/16/25% for 15 seconds after getting a critical effect from your Flash Heal, Heal, Greater Heal, or Prayer of Healing.',
      tier: 3,
      column: 2,
      maxRanks: 3,
      requiredPoints: 10,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 100, procTrigger: 'healing_crit', procEffect: 'armor_buff', valuePerRank: 8 }],
    },
    {
      id: 'holy_reach',
      name: 'Holy Reach',
      description: 'Increases the range of your Smite, Holy Fire, Heal, and Greater Heal spells by 10/20%.',
      tier: 3,
      column: 3,
      maxRanks: 2,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'holyRange', valuePerRank: 10, isPercentage: true }],
    },
    // Tier 4
    {
      id: 'improved_healing',
      name: 'Improved Healing',
      description: 'Reduces the mana cost of your Lesser Heal, Heal, and Greater Heal spells by 5/10/15%.',
      tier: 4,
      column: 1,
      maxRanks: 3,
      requiredPoints: 15,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'healManaCost', valuePerRank: -5, isPercentage: true }],
    },
    {
      id: 'searing_light',
      name: 'Searing Light',
      description: 'Increases the damage of your Smite and Holy Fire spells by 5/10%.',
      tier: 4,
      column: 2,
      maxRanks: 2,
      requiredPoints: 15,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'holyDamageDamage', valuePerRank: 5, isPercentage: true }],
    },
    // Tier 5
    {
      id: 'spiritual_healing',
      name: 'Spiritual Healing',
      description: 'Increases the amount healed by your healing spells by 2/4/6/8/10%.',
      tier: 5,
      column: 2,
      maxRanks: 5,
      requiredPoints: 20,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'healingDone', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 6
    {
      id: 'spirit_of_redemption',
      name: 'Spirit of Redemption',
      description: 'Increases total Spirit by 5% and upon death become the Spirit of Redemption for 15 seconds to heal allies.',
      tier: 6,
      column: 2,
      maxRanks: 1,
      requiredPoints: 25,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'spirit', valuePerRank: 5, isPercentage: true }],
    },
    // Tier 7 - Capstone
    {
      id: 'circle_of_healing_talent',
      name: 'Circle of Healing',
      description: 'Heals all friendly party members within 15 yards for 323 to 361.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'circle_of_healing', valuePerRank: 1 }],
    },
  ],
};

const shadowTalentTree: TalentTreeDefinition = {
  id: 'shadow',
  name: 'Shadow',
  description: 'Focuses on damage over time and Shadow spells for a DPS playstyle.',
  role: 'dps',
  talents: [
    // Tier 1
    {
      id: 'spirit_tap',
      name: 'Spirit Tap',
      description: 'Gives you a 20/40/60/80/100% chance to gain 100% bonus to your Spirit after killing a target that yields experience.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 20, procTrigger: 'kill_xp_mob', procEffect: 'spirit_bonus', valuePerRank: 20 }],
    },
    {
      id: 'blackout',
      name: 'Blackout',
      description: 'Gives your Shadow damage spells a 2/4/6/8/10% chance to stun the target for 3 seconds.',
      tier: 1,
      column: 3,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 2, procTrigger: 'shadow_damage', procEffect: 'stun', valuePerRank: 2 }],
    },
    // Tier 2
    {
      id: 'improved_shadow_word_pain',
      name: 'Improved Shadow Word: Pain',
      description: 'Increases the duration of your Shadow Word: Pain spell by 3/6 seconds.',
      tier: 2,
      column: 1,
      maxRanks: 2,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'shadow_word_pain', stat: 'duration', valuePerRank: 3 }],
    },
    {
      id: 'shadow_focus',
      name: 'Shadow Focus',
      description: 'Reduces your target\'s chance to resist your Shadow spells by 2/4/6/8/10%.',
      tier: 2,
      column: 2,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'shadowHit', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 3
    {
      id: 'improved_mind_blast',
      name: 'Improved Mind Blast',
      description: 'Reduces the cooldown of your Mind Blast spell by 0.5/1/1.5/2/2.5 seconds.',
      tier: 3,
      column: 1,
      maxRanks: 5,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'mind_blast', stat: 'cooldown', valuePerRank: -0.5 }],
    },
    {
      id: 'mind_flay',
      name: 'Mind Flay',
      description: 'Unlocks Mind Flay, which assaults the target\'s mind causing Shadow damage over 3 seconds and slowing movement.',
      tier: 3,
      column: 2,
      maxRanks: 1,
      requiredPoints: 10,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'mind_flay', valuePerRank: 1 }],
    },
    // Tier 4
    {
      id: 'shadow_weaving',
      name: 'Shadow Weaving',
      description: 'Your Shadow damage spells have a 20/40/60/80/100% chance to cause your target to be vulnerable to Shadow damage, increasing Shadow damage by 3% for 15 seconds. Stacks 5 times.',
      tier: 4,
      column: 2,
      maxRanks: 5,
      requiredPoints: 15,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 20, procTrigger: 'shadow_damage', procEffect: 'shadow_vulnerability', valuePerRank: 20 }],
    },
    {
      id: 'vampiric_embrace',
      name: 'Vampiric Embrace',
      description: 'Afflicts your target with Shadow energy that causes you to be healed for 15% of any Shadow spell damage you deal.',
      tier: 4,
      column: 3,
      maxRanks: 1,
      requiredPoints: 15,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'vampiric_embrace', valuePerRank: 1 }],
    },
    // Tier 5
    {
      id: 'silence',
      name: 'Silence',
      description: 'Silences the target, preventing them from casting spells for 5 seconds.',
      tier: 5,
      column: 1,
      maxRanks: 1,
      requiredPoints: 20,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'silence', valuePerRank: 1 }],
    },
    {
      id: 'darkness',
      name: 'Darkness',
      description: 'Increases your Shadow spell damage by 2/4/6/8/10%.',
      tier: 5,
      column: 2,
      maxRanks: 5,
      requiredPoints: 20,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'shadowDamage', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 7 - Capstone
    {
      id: 'shadowform_talent',
      name: 'Shadowform',
      description: 'Assume a Shadowform, increasing your Shadow damage by 15% and reducing Physical damage taken by 15%.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'shadowform', valuePerRank: 1 }],
    },
  ],
};

// ============= PRIEST CLASS DEFINITION =============

export const priestClass: ClassDefinition = {
  id: 'priest',
  name: 'Priest',
  description: 'Cloth-wearing casters best known as the premier healers, with powerful single-target and area heals plus strong buffs. Shadow specialization provides sustained damage.',
  resourceType: 'mana',
  armorType: 'cloth',

  baseStats: {
    health: 70,
    resource: 175, // Starting mana
    strength: 8,
    agility: 8,
    intellect: 25,
    stamina: 11,
    spirit: 20,
  },

  statScaling: {
    strengthToAP: 0,
    agilityToAP: 0,
    agilityToCrit: 0,
    agilityToRangedAP: 0,
    intellectToMana: 15,          // 1 INT = 15 mana
    intellectToSpellPower: 1.35,   // Increased from 1.2 for parity with Mage
    intellectToSpellCrit: 0.03,    // 1 INT = 0.03% spell crit
    staminaToHealth: 10,
    spiritToRegen: 1.2,            // Higher spirit scaling for regen
  },

  talentTrees: [disciplineTalentTree, holyTalentTree, shadowTalentTree],
  abilities: priestAbilities,
};

export default priestClass;
