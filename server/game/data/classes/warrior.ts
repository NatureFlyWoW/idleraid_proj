import type { ClassDefinition, AbilityDefinition, TalentTreeDefinition } from '@shared/types';

// ============= WARRIOR ABILITIES =============

const warriorAbilities: AbilityDefinition[] = [
  // Core abilities (no talent required)
  {
    id: 'heroic_strike',
    name: 'Heroic Strike',
    description: 'A strong attack that increases melee damage by 138.',
    type: 'instant',
    resourceCost: 15,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 138,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    levelRequired: 1,
  },
  {
    id: 'rend',
    name: 'Rend',
    description: 'Wounds the target causing them to bleed for 147 damage over 21 seconds.',
    type: 'instant',
    resourceCost: 10,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 147,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: true,
    isHot: false,
    tickCount: 7,
    tickIntervalSeconds: 3,
    requiresWeapon: 'melee',
    levelRequired: 4,
  },
  {
    id: 'thunder_clap',
    name: 'Thunder Clap',
    description: 'Blasts nearby enemies increasing the time between their attacks and dealing 103 damage.',
    type: 'instant',
    resourceCost: 20,
    cooldownSeconds: 4,
    castTimeSeconds: 0,
    baseDamage: 103,
    baseHealing: 0,
    apCoefficient: 0.05,
    spCoefficient: 0,
    isAoE: true,
    maxTargets: 4,
    isDot: false,
    isHot: false,
    levelRequired: 6,
  },
  {
    id: 'sunder_armor',
    name: 'Sunder Armor',
    description: 'Reduces target armor by 450 for 30 seconds. Stacks up to 5 times.',
    type: 'instant',
    resourceCost: 15,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    levelRequired: 10,
  },
  {
    id: 'overpower',
    name: 'Overpower',
    description: 'Instantly overpower the enemy, causing weapon damage plus 35. Can only be used after target dodges.',
    type: 'instant',
    resourceCost: 5,
    cooldownSeconds: 5,
    castTimeSeconds: 0,
    baseDamage: 35,
    baseHealing: 0,
    apCoefficient: 0.1,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    levelRequired: 12,
  },
  {
    id: 'execute',
    name: 'Execute',
    description: 'Attempt to finish off a wounded foe, causing 600 damage and consuming up to 30 additional rage.',
    type: 'instant',
    resourceCost: 15,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 600,
    baseHealing: 0,
    apCoefficient: 0.2,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    levelRequired: 24,
  },
  {
    id: 'whirlwind',
    name: 'Whirlwind',
    description: 'In a whirlwind of steel you attack up to 4 enemies, causing weapon damage to each.',
    type: 'instant',
    resourceCost: 25,
    cooldownSeconds: 10,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0.45,
    spCoefficient: 0,
    isAoE: true,
    maxTargets: 4,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    levelRequired: 36,
  },
  // Talent abilities will be added with requiresTalent
  {
    id: 'mortal_strike',
    name: 'Mortal Strike',
    description: 'A vicious strike that deals weapon damage plus 160 and reduces healing on target by 50% for 10 seconds.',
    type: 'instant',
    resourceCost: 30,
    cooldownSeconds: 6,
    castTimeSeconds: 0,
    baseDamage: 160,
    baseHealing: 0,
    apCoefficient: 0.1,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    requiresTalent: 'mortal_strike_talent',
    levelRequired: 40,
  },
  {
    id: 'bloodthirst',
    name: 'Bloodthirst',
    description: 'Instantly attack the target causing damage equal to 45% of your attack power. Heals for 1% of max health.',
    type: 'instant',
    resourceCost: 30,
    cooldownSeconds: 6,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0.45,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'melee',
    requiresTalent: 'bloodthirst_talent',
    levelRequired: 40,
  },
  {
    id: 'shield_slam',
    name: 'Shield Slam',
    description: 'Slam the target with your shield, causing 342 to 358 damage, modified by your shield block value.',
    type: 'instant',
    resourceCost: 20,
    cooldownSeconds: 6,
    castTimeSeconds: 0,
    baseDamage: 350,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresWeapon: 'shield',
    requiresTalent: 'shield_slam_talent',
    levelRequired: 40,
  },
];

// ============= TALENT TREES =============

const armsTalentTree: TalentTreeDefinition = {
  id: 'arms',
  name: 'Arms',
  description: 'Two-handed weapon specialization with powerful burst damage abilities.',
  role: 'dps',
  talents: [
    // Tier 1 (0 points required)
    {
      id: 'improved_heroic_strike',
      name: 'Improved Heroic Strike',
      description: 'Reduces the cost of your Heroic Strike ability by 1/2/3 rage.',
      tier: 1,
      column: 1,
      maxRanks: 3,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'heroic_strike', stat: 'resourceCost', valuePerRank: -1 }],
    },
    {
      id: 'deflection',
      name: 'Deflection',
      description: 'Increases your Parry chance by 1/2/3/4/5%.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'parryChance', valuePerRank: 1, isPercentage: true }],
    },
    {
      id: 'improved_rend',
      name: 'Improved Rend',
      description: 'Increases the bleed damage done by your Rend ability by 15/25/35%.',
      tier: 1,
      column: 3,
      maxRanks: 3,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'rend', stat: 'damage', valuePerRank: 15, isPercentage: true }],
    },
    // Tier 2 (5 points required)
    {
      id: 'deep_wounds',
      name: 'Deep Wounds',
      description: 'Your critical strikes cause the target to bleed for 20/40/60% weapon damage over 12 seconds.',
      tier: 2,
      column: 2,
      maxRanks: 3,
      requiredPoints: 5,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 100, procTrigger: 'critical_hit', valuePerRank: 20 }],
    },
    {
      id: 'tactical_mastery',
      name: 'Tactical Mastery',
      description: 'You retain up to 5/10/15/20/25 rage when switching stances.',
      tier: 2,
      column: 3,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'stanceRageRetention', valuePerRank: 5 }],
    },
    // Tier 3 (10 points required)
    {
      id: 'improved_overpower',
      name: 'Improved Overpower',
      description: 'Increases the critical strike chance of your Overpower ability by 25/50%.',
      tier: 3,
      column: 1,
      maxRanks: 2,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'overpower', stat: 'critChance', valuePerRank: 25 }],
    },
    {
      id: 'anger_management',
      name: 'Anger Management',
      description: 'Generates 1 rage every 3 seconds.',
      tier: 3,
      column: 2,
      maxRanks: 1,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'ragePerSecond', valuePerRank: 0.33 }],
    },
    // Tier 4 (15 points required)
    {
      id: 'impale',
      name: 'Impale',
      description: 'Increases the critical strike damage bonus of your abilities by 10/20%.',
      tier: 4,
      column: 2,
      maxRanks: 2,
      requiredPoints: 15,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'critDamageBonus', valuePerRank: 10, isPercentage: true }],
    },
    // Tier 5 (20 points required)
    {
      id: 'two_handed_weapon_spec',
      name: 'Two-Handed Weapon Specialization',
      description: 'Increases damage done with two-handed weapons by 1/2/3/4/5%.',
      tier: 5,
      column: 1,
      maxRanks: 5,
      requiredPoints: 20,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'twoHandedDamage', valuePerRank: 1, isPercentage: true }],
    },
    {
      id: 'sweeping_strikes',
      name: 'Sweeping Strikes',
      description: 'Your next 5 melee attacks strike an additional nearby opponent.',
      tier: 5,
      column: 2,
      maxRanks: 1,
      requiredPoints: 20,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'sweeping_strikes', valuePerRank: 1 }],
    },
    // Tier 6 (25 points required)
    {
      id: 'improved_hamstring',
      name: 'Improved Hamstring',
      description: 'Gives your Hamstring ability a 5/10/15% chance to immobilize the target for 5 seconds.',
      tier: 6,
      column: 2,
      maxRanks: 3,
      requiredPoints: 25,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 5, procTrigger: 'hamstring', procEffect: 'immobilize', valuePerRank: 5 }],
    },
    // Tier 7 (30 points required) - Capstone
    {
      id: 'mortal_strike_talent',
      name: 'Mortal Strike',
      description: 'A vicious strike that deals weapon damage plus 160 and reduces healing on target by 50% for 10 seconds.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'mortal_strike', valuePerRank: 1 }],
    },
  ],
};

const furyTalentTree: TalentTreeDefinition = {
  id: 'fury',
  name: 'Fury',
  description: 'Dual-wielding specialization with sustained damage and frenzy mechanics.',
  role: 'dps',
  talents: [
    // Tier 1
    {
      id: 'cruelty',
      name: 'Cruelty',
      description: 'Increases your chance to get a critical strike with melee weapons by 1/2/3/4/5%.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'meleeCritChance', valuePerRank: 1, isPercentage: true }],
    },
    {
      id: 'booming_voice',
      name: 'Booming Voice',
      description: 'Increases the area of effect and duration of your Battle Shout and Demoralizing Shout by 10/20/30/40/50%.',
      tier: 1,
      column: 3,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'battle_shout', stat: 'duration', valuePerRank: 10, isPercentage: true }],
    },
    // Tier 2
    {
      id: 'improved_battle_shout',
      name: 'Improved Battle Shout',
      description: 'Increases the melee attack power granted by your Battle Shout by 5/10/15/20/25%.',
      tier: 2,
      column: 2,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'battle_shout', stat: 'attackPower', valuePerRank: 5, isPercentage: true }],
    },
    {
      id: 'dual_wield_specialization',
      name: 'Dual Wield Specialization',
      description: 'Increases the damage done by your offhand weapon by 5/10/15/20/25%.',
      tier: 2,
      column: 3,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'offhandDamage', valuePerRank: 5, isPercentage: true }],
    },
    // Tier 3
    {
      id: 'enrage',
      name: 'Enrage',
      description: 'Gives you a 5/10/15/20/25% chance to become Enraged after taking a critical hit, increasing damage by 5% for 12 seconds.',
      tier: 3,
      column: 2,
      maxRanks: 5,
      requiredPoints: 10,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 5, procTrigger: 'receive_crit', procEffect: 'damage_increase', valuePerRank: 5 }],
    },
    // Tier 4
    {
      id: 'death_wish',
      name: 'Death Wish',
      description: 'When activated, increases your physical damage by 20% and makes you immune to Fear effects, but reduces armor by 20% for 30 seconds.',
      tier: 4,
      column: 2,
      maxRanks: 1,
      requiredPoints: 15,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'death_wish', valuePerRank: 1 }],
    },
    {
      id: 'flurry',
      name: 'Flurry',
      description: 'Increases your attack speed by 5/10/15/20/25% for your next 3 swings after dealing a melee critical strike.',
      tier: 4,
      column: 3,
      maxRanks: 5,
      requiredPoints: 15,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 100, procTrigger: 'melee_crit', procEffect: 'attack_speed', valuePerRank: 5 }],
    },
    // Tier 7 - Capstone
    {
      id: 'bloodthirst_talent',
      name: 'Bloodthirst',
      description: 'Instantly attack the target causing damage equal to 45% of your attack power.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'bloodthirst', valuePerRank: 1 }],
    },
  ],
};

const protectionTalentTree: TalentTreeDefinition = {
  id: 'protection',
  name: 'Protection',
  description: 'Tank specialization focused on survival and threat generation.',
  role: 'tank',
  talents: [
    // Tier 1
    {
      id: 'shield_specialization',
      name: 'Shield Specialization',
      description: 'Increases your chance to block attacks with a shield by 1/2/3/4/5% and generates 1 rage when a block occurs.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'blockChance', valuePerRank: 1, isPercentage: true }],
    },
    {
      id: 'anticipation',
      name: 'Anticipation',
      description: 'Increases your Defense skill by 2/4/6/8/10.',
      tier: 1,
      column: 3,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'defense', valuePerRank: 2 }],
    },
    // Tier 2
    {
      id: 'improved_bloodrage',
      name: 'Improved Bloodrage',
      description: 'Increases the instant rage generated by your Bloodrage ability by 3/6.',
      tier: 2,
      column: 1,
      maxRanks: 2,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'bloodrage', stat: 'rageGenerated', valuePerRank: 3 }],
    },
    {
      id: 'toughness',
      name: 'Toughness',
      description: 'Increases your armor value from items by 2/4/6/8/10%.',
      tier: 2,
      column: 2,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'armorFromItems', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 3
    {
      id: 'last_stand',
      name: 'Last Stand',
      description: 'When activated, temporarily grants you 30% of your maximum health for 20 seconds.',
      tier: 3,
      column: 1,
      maxRanks: 1,
      requiredPoints: 10,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'last_stand', valuePerRank: 1 }],
    },
    {
      id: 'defiance',
      name: 'Defiance',
      description: 'Increases threat generated while in Defensive Stance by 3/6/9/12/15%.',
      tier: 3,
      column: 2,
      maxRanks: 5,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'threatGeneration', valuePerRank: 3, isPercentage: true }],
    },
    // Tier 5
    {
      id: 'one_handed_weapon_spec',
      name: 'One-Handed Weapon Specialization',
      description: 'Increases damage done with one-handed weapons by 2/4/6/8/10%.',
      tier: 5,
      column: 2,
      maxRanks: 5,
      requiredPoints: 20,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'oneHandedDamage', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 7 - Capstone
    {
      id: 'shield_slam_talent',
      name: 'Shield Slam',
      description: 'Slam the target with your shield, causing high damage modified by your shield block value.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'shield_slam', valuePerRank: 1 }],
    },
  ],
};

// ============= WARRIOR CLASS DEFINITION =============

export const warriorClass: ClassDefinition = {
  id: 'warrior',
  name: 'Warrior',
  description: 'Heavily armored frontline fighters who specialize in melee damage, using rage generated in combat to fuel powerful attacks and defensive abilities.',
  resourceType: 'rage',
  armorType: 'plate',

  baseStats: {
    health: 100,
    resource: 0, // Rage starts at 0
    strength: 20,
    agility: 10,
    intellect: 8,
    stamina: 18,
    spirit: 10,
  },

  statScaling: {
    strengthToAP: 2.0,       // 1 STR = 2 AP
    agilityToAP: 0,
    agilityToCrit: 0.05,     // 1 AGI = 0.05% crit
    agilityToRangedAP: 0,
    intellectToMana: 0,
    intellectToSpellPower: 0,
    intellectToSpellCrit: 0,
    staminaToHealth: 10,
    spiritToRegen: 0,
  },

  talentTrees: [armsTalentTree, furyTalentTree, protectionTalentTree],
  abilities: warriorAbilities,
};

export default warriorClass;
