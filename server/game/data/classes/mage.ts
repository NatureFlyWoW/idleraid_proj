import type { ClassDefinition, AbilityDefinition, TalentTreeDefinition } from '@shared/types';

// ============= MAGE ABILITIES =============

const mageAbilities: AbilityDefinition[] = [
  // Core abilities
  {
    id: 'fireball',
    name: 'Fireball',
    description: 'Hurls a fiery ball that causes 561 to 715 Fire damage.',
    type: 'cast',
    resourceCost: 350,
    cooldownSeconds: 0,
    castTimeSeconds: 3.0,
    baseDamage: 638,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.857,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 1,
  },
  {
    id: 'frostbolt',
    name: 'Frostbolt',
    description: 'Launches a bolt of frost at the enemy, causing 515 to 555 Frost damage and slowing movement speed.',
    type: 'cast',
    resourceCost: 290,
    cooldownSeconds: 0,
    castTimeSeconds: 2.5,
    baseDamage: 535,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.814,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 4,
  },
  {
    id: 'arcane_missiles',
    name: 'Arcane Missiles',
    description: 'Launches 5 waves of Arcane Missiles at the enemy over 5 seconds, each wave dealing 230 damage.',
    type: 'channel',
    resourceCost: 595,
    cooldownSeconds: 0,
    castTimeSeconds: 5.0,
    baseDamage: 1150,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 1.0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 8,
  },
  {
    id: 'fire_blast',
    name: 'Fire Blast',
    description: 'Blasts the enemy for 431 to 509 Fire damage.',
    type: 'instant',
    resourceCost: 340,
    cooldownSeconds: 8,
    castTimeSeconds: 0,
    baseDamage: 470,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.429,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 6,
  },
  {
    id: 'frost_nova',
    name: 'Frost Nova',
    description: 'Blasts enemies near the caster for 71 to 79 Frost damage and freezes them in place for 8 seconds.',
    type: 'instant',
    resourceCost: 55,
    cooldownSeconds: 25,
    castTimeSeconds: 0,
    baseDamage: 75,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.1,
    isAoE: true,
    maxTargets: 5,
    isDot: false,
    isHot: false,
    levelRequired: 10,
  },
  {
    id: 'scorch',
    name: 'Scorch',
    description: 'Scorches the enemy for 237 to 280 Fire damage.',
    type: 'cast',
    resourceCost: 150,
    cooldownSeconds: 0,
    castTimeSeconds: 1.5,
    baseDamage: 258,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.429,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 22,
  },
  {
    id: 'arcane_explosion',
    name: 'Arcane Explosion',
    description: 'Causes an explosion of arcane magic around the caster, causing 249 to 270 damage to all nearby enemies.',
    type: 'instant',
    resourceCost: 390,
    cooldownSeconds: 0,
    castTimeSeconds: 0,
    baseDamage: 260,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.143,
    isAoE: true,
    maxTargets: 10,
    isDot: false,
    isHot: false,
    levelRequired: 14,
  },
  {
    id: 'evocation',
    name: 'Evocation',
    description: 'Evocation restores 60% of your total mana over 8 seconds while channeling.',
    type: 'channel',
    resourceCost: 0,
    cooldownSeconds: 480, // 8 minutes
    castTimeSeconds: 8.0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    levelRequired: 20,
  },
  // Talent abilities
  {
    id: 'pyroblast',
    name: 'Pyroblast',
    description: 'Hurls an immense fiery boulder that causes 716 to 890 Fire damage and an additional 268 Fire damage over 12 seconds.',
    type: 'cast',
    resourceCost: 440,
    cooldownSeconds: 0,
    castTimeSeconds: 6.0,
    baseDamage: 803,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 1.0,
    isAoE: false,
    isDot: true,
    isHot: false,
    tickCount: 4,
    tickIntervalSeconds: 3,
    requiresTalent: 'pyroblast_talent',
    levelRequired: 40,
  },
  {
    id: 'ice_barrier',
    name: 'Ice Barrier',
    description: 'Instantly shields you, absorbing 818 damage. Lasts 1 minute.',
    type: 'instant',
    resourceCost: 305,
    cooldownSeconds: 30,
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0.1,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'ice_barrier_talent',
    levelRequired: 40,
  },
  {
    id: 'arcane_power',
    name: 'Arcane Power',
    description: 'When activated, your spells deal 30% more damage while costing 30% more mana for 15 seconds.',
    type: 'instant',
    resourceCost: 0,
    cooldownSeconds: 180, // 3 minutes
    castTimeSeconds: 0,
    baseDamage: 0,
    baseHealing: 0,
    apCoefficient: 0,
    spCoefficient: 0,
    isAoE: false,
    isDot: false,
    isHot: false,
    requiresTalent: 'arcane_power_talent',
    levelRequired: 40,
  },
];

// ============= TALENT TREES =============

const arcaneTalentTree: TalentTreeDefinition = {
  id: 'arcane',
  name: 'Arcane',
  description: 'Focuses on mana management, arcane spells, and utility.',
  role: 'dps',
  talents: [
    // Tier 1
    {
      id: 'arcane_subtlety',
      name: 'Arcane Subtlety',
      description: 'Reduces the threat caused by your Arcane spells by 20/40%.',
      tier: 1,
      column: 1,
      maxRanks: 2,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'arcaneThreatReduction', valuePerRank: 20, isPercentage: true }],
    },
    {
      id: 'arcane_focus',
      name: 'Arcane Focus',
      description: 'Reduces the chance your Arcane spells can be resisted by 2/4/6/8/10%.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'arcaneHit', valuePerRank: 2, isPercentage: true }],
    },
    {
      id: 'improved_arcane_missiles',
      name: 'Improved Arcane Missiles',
      description: 'Increases the critical strike chance of your Arcane Missiles spell by 2/4/6/8/10%.',
      tier: 1,
      column: 3,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'arcane_missiles', stat: 'critChance', valuePerRank: 2 }],
    },
    // Tier 2
    {
      id: 'arcane_concentration',
      name: 'Arcane Concentration',
      description: 'Gives you a 2/4/6/8/10% chance of entering a Clearcasting state after any damage spell hits a target.',
      tier: 2,
      column: 2,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 2, procTrigger: 'spell_hit', procEffect: 'clearcasting', valuePerRank: 2 }],
    },
    {
      id: 'arcane_mind',
      name: 'Arcane Mind',
      description: 'Increases your total Intellect by 3/6/9/12/15%.',
      tier: 2,
      column: 3,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'intellect', valuePerRank: 3, isPercentage: true }],
    },
    // Tier 3
    {
      id: 'arcane_meditation',
      name: 'Arcane Meditation',
      description: 'Allows 5/10/15% of your Mana regeneration to continue while casting.',
      tier: 3,
      column: 2,
      maxRanks: 3,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'manaRegenWhileCasting', valuePerRank: 5, isPercentage: true }],
    },
    // Tier 4
    {
      id: 'presence_of_mind',
      name: 'Presence of Mind',
      description: 'When activated, your next Mage spell becomes instant cast. 3 minute cooldown.',
      tier: 4,
      column: 2,
      maxRanks: 1,
      requiredPoints: 15,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'presence_of_mind', valuePerRank: 1 }],
    },
    // Tier 5
    {
      id: 'arcane_instability',
      name: 'Arcane Instability',
      description: 'Increases the damage and critical strike chance of your spells by 1/2/3%.',
      tier: 5,
      column: 2,
      maxRanks: 3,
      requiredPoints: 20,
      type: 'passive',
      effects: [
        { type: 'stat_bonus', stat: 'spellDamage', valuePerRank: 1, isPercentage: true },
        { type: 'stat_bonus', stat: 'spellCritChance', valuePerRank: 1, isPercentage: true },
      ],
    },
    // Tier 7 - Capstone
    {
      id: 'arcane_power_talent',
      name: 'Arcane Power',
      description: 'When activated, spells deal 30% more damage but cost 30% more mana for 15 seconds.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'arcane_power', valuePerRank: 1 }],
    },
  ],
};

const fireTalentTree: TalentTreeDefinition = {
  id: 'fire',
  name: 'Fire',
  description: 'Focuses on high burst damage through critical strikes and combustion.',
  role: 'dps',
  talents: [
    // Tier 1
    {
      id: 'improved_fireball',
      name: 'Improved Fireball',
      description: 'Reduces the casting time of your Fireball spell by 0.1/0.2/0.3/0.4/0.5 seconds.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'fireball', stat: 'castTime', valuePerRank: -0.1 }],
    },
    {
      id: 'impact',
      name: 'Impact',
      description: 'Your Fire spells have a 2/4/6/8/10% chance to stun the target for 2 seconds.',
      tier: 1,
      column: 3,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 2, procTrigger: 'fire_spell', procEffect: 'stun', valuePerRank: 2 }],
    },
    // Tier 2
    {
      id: 'ignite',
      name: 'Ignite',
      description: 'Your critical strikes from Fire spells cause the target to burn for 8/16/24/32/40% of spell damage over 4 seconds.',
      tier: 2,
      column: 1,
      maxRanks: 5,
      requiredPoints: 5,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 100, procTrigger: 'fire_crit', procEffect: 'ignite', valuePerRank: 8 }],
    },
    {
      id: 'flame_throwing',
      name: 'Flame Throwing',
      description: 'Increases the range of your Fire spells by 3/6 yards.',
      tier: 2,
      column: 2,
      maxRanks: 2,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'fireRange', valuePerRank: 3 }],
    },
    {
      id: 'incinerate',
      name: 'Incinerate',
      description: 'Increases the critical strike chance of your Fire Blast and Scorch spells by 2/4%.',
      tier: 2,
      column: 3,
      maxRanks: 2,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'fire_blast', stat: 'critChance', valuePerRank: 2 }],
    },
    // Tier 3
    {
      id: 'improved_scorch',
      name: 'Improved Scorch',
      description: 'Your Scorch spells have a 33/66/100% chance to cause Fire Vulnerability, increasing Fire damage by 3% for 30 seconds. Stacks 5 times.',
      tier: 3,
      column: 1,
      maxRanks: 3,
      requiredPoints: 10,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 33, procTrigger: 'scorch', procEffect: 'fire_vulnerability', valuePerRank: 33 }],
    },
    {
      id: 'master_of_elements',
      name: 'Master of Elements',
      description: 'Your Fire and Frost spell criticals refund 10/20/30% of their base mana cost.',
      tier: 3,
      column: 3,
      maxRanks: 3,
      requiredPoints: 10,
      type: 'proc',
      effects: [{ type: 'proc', procChance: 100, procTrigger: 'spell_crit', procEffect: 'mana_refund', valuePerRank: 10 }],
    },
    // Tier 4
    {
      id: 'critical_mass',
      name: 'Critical Mass',
      description: 'Increases the critical strike chance of your Fire spells by 2/4/6%.',
      tier: 4,
      column: 2,
      maxRanks: 3,
      requiredPoints: 15,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'fireCritChance', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 5
    {
      id: 'fire_power',
      name: 'Fire Power',
      description: 'Increases the damage done by your Fire spells by 2/4/6/8/10%.',
      tier: 5,
      column: 2,
      maxRanks: 5,
      requiredPoints: 20,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'fireDamage', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 6
    {
      id: 'combustion',
      name: 'Combustion',
      description: 'When activated, increases your Fire spell critical chance by 10% until you have 3 critical strikes.',
      tier: 6,
      column: 2,
      maxRanks: 1,
      requiredPoints: 25,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'combustion', valuePerRank: 1 }],
    },
    // Tier 7 - Capstone
    {
      id: 'pyroblast_talent',
      name: 'Pyroblast',
      description: 'Hurls an immense fiery boulder causing massive Fire damage plus a DOT.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'pyroblast', valuePerRank: 1 }],
    },
  ],
};

const frostTalentTree: TalentTreeDefinition = {
  id: 'frost',
  name: 'Frost',
  description: 'Focuses on consistent damage, control, and survivability.',
  role: 'dps',
  talents: [
    // Tier 1
    {
      id: 'improved_frostbolt',
      name: 'Improved Frostbolt',
      description: 'Reduces the casting time of your Frostbolt spell by 0.1/0.2/0.3/0.4/0.5 seconds.',
      tier: 1,
      column: 2,
      maxRanks: 5,
      requiredPoints: 0,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'frostbolt', stat: 'castTime', valuePerRank: -0.1 }],
    },
    {
      id: 'elemental_precision',
      name: 'Elemental Precision',
      description: 'Reduces the mana cost of your Frost and Fire spells by 1/2/3% and increases hit by 1/2/3%.',
      tier: 1,
      column: 3,
      maxRanks: 3,
      requiredPoints: 0,
      type: 'passive',
      effects: [
        { type: 'stat_bonus', stat: 'frostFireManaCost', valuePerRank: -1, isPercentage: true },
        { type: 'stat_bonus', stat: 'spellHit', valuePerRank: 1, isPercentage: true },
      ],
    },
    // Tier 2
    {
      id: 'improved_frost_nova',
      name: 'Improved Frost Nova',
      description: 'Reduces the cooldown of your Frost Nova spell by 2/4 seconds.',
      tier: 2,
      column: 1,
      maxRanks: 2,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'ability_modifier', abilityId: 'frost_nova', stat: 'cooldown', valuePerRank: -2 }],
    },
    {
      id: 'permafrost',
      name: 'Permafrost',
      description: 'Increases the duration of your Chill effects by 1/2/3 seconds and reduces target speed by an additional 4/7/10%.',
      tier: 2,
      column: 2,
      maxRanks: 3,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'chillDuration', valuePerRank: 1 }],
    },
    {
      id: 'piercing_ice',
      name: 'Piercing Ice',
      description: 'Increases the damage done by your Frost spells by 2/4/6%.',
      tier: 2,
      column: 3,
      maxRanks: 3,
      requiredPoints: 5,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'frostDamage', valuePerRank: 2, isPercentage: true }],
    },
    // Tier 3
    {
      id: 'cold_snap',
      name: 'Cold Snap',
      description: 'When activated, instantly resets the cooldown on all Frost spells. 10 minute cooldown.',
      tier: 3,
      column: 1,
      maxRanks: 1,
      requiredPoints: 10,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'cold_snap', valuePerRank: 1 }],
    },
    {
      id: 'shatter',
      name: 'Shatter',
      description: 'Increases the critical strike chance of your spells against frozen targets by 10/20/30/40/50%.',
      tier: 3,
      column: 3,
      maxRanks: 5,
      requiredPoints: 10,
      type: 'passive',
      effects: [{ type: 'stat_bonus', stat: 'frozentargetCrit', valuePerRank: 10, isPercentage: true }],
    },
    // Tier 5
    {
      id: 'ice_block',
      name: 'Ice Block',
      description: 'You become encased in ice, protecting you from all attacks and spells for 10 seconds, but unable to act.',
      tier: 5,
      column: 2,
      maxRanks: 1,
      requiredPoints: 20,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'ice_block', valuePerRank: 1 }],
    },
    // Tier 7 - Capstone
    {
      id: 'ice_barrier_talent',
      name: 'Ice Barrier',
      description: 'Instantly shields you, absorbing damage. Lasts 1 minute.',
      tier: 7,
      column: 2,
      maxRanks: 1,
      requiredPoints: 30,
      type: 'active',
      effects: [{ type: 'ability_unlock', abilityId: 'ice_barrier', valuePerRank: 1 }],
    },
  ],
};

// ============= MAGE CLASS DEFINITION =============

export const mageClass: ClassDefinition = {
  id: 'mage',
  name: 'Mage',
  description: 'Fragile cloth spellcasters who focus on high burst ranged damage using frost, fire, or arcane spells.',
  resourceType: 'mana',
  armorType: 'cloth',

  baseStats: {
    health: 65,
    resource: 190, // Starting mana
    strength: 7,
    agility: 7,
    intellect: 26,
    stamina: 10,
    spirit: 15,
  },

  statScaling: {
    strengthToAP: 0,
    agilityToAP: 0,
    agilityToCrit: 0,
    agilityToRangedAP: 0,
    intellectToMana: 15,          // 1 INT = 15 mana
    intellectToSpellPower: 1.5,    // Highest spell power scaling
    intellectToSpellCrit: 0.03,    // 1 INT = 0.03% spell crit
    staminaToHealth: 10,
    spiritToRegen: 1.0,
  },

  talentTrees: [arcaneTalentTree, fireTalentTree, frostTalentTree],
  abilities: mageAbilities,
};

export default mageClass;
